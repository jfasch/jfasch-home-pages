
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<meta content="The Linux PWM Userspace Interface" name="description" />
<meta content="linux, onewire, w1, DS18B20, DS2482, raspberry pi, raspi, userspace, hwmon, sysfs" name="keywords" />

    <title>Linux and OneWire (using DS18B20 Temperature Sensor as Slave) &#8212; Jörg Faschingbauer</title>
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/css/jf-alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/sphinxcontrib-images/LightBox2/lightbox2/dist/css/lightbox.css" />
    <script data-url_root="../../../../../../" id="documentation_options" src="../../../../../../_static/documentation_options.js"></script>
    <script src="../../../../../../_static/jquery.js"></script>
    <script src="../../../../../../_static/underscore.js"></script>
    <script src="../../../../../../_static/doctools.js"></script>
    <script src="../../../../../../_static/thebelab-helper.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../../../../_static/sphinxcontrib-images/LightBox2/lightbox2/dist/js/lightbox-plus-jquery.min.js"></script>
    <script src="../../../../../../_static/sphinxcontrib-images/LightBox2/lightbox2-customize/jquery-noconflict.js"></script>
    <link rel="canonical" href="https://www.faschingbauer.me/trainings/material/soup/linux/hardware/w1/topic.html" />
    <link rel="index" title="Index" href="../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../search.html" />
    <link rel="next" title="Linux and I2C (using LM73 Temperature Sensor as Slave)" href="../i2c/topic.html" />
    <link rel="prev" title="Hardware, Kernel" href="../can/40-harware.html" /> 
   
  <link rel="stylesheet" href="../../../../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />
 
<link
  rel="alternate"
  type="application/atom+xml"
  href="../../../../../../blog/atom.xml"
  title="Jörg Faschingbauer"
/>
 
<link href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css" rel="stylesheet" />

<style type="text/css">
  ul.ablog-archive {
    list-style: none;
    overflow: auto;
    margin-left: 0px;
  }
  ul.ablog-archive li {
    float: left;
    margin-right: 5px;
    font-size: 80%;
  }
  ul.postlist a {
    font-style: italic;
  }
  ul.postlist-style-disc {
    list-style-type: disc;
  }
  ul.postlist-style-none {
    list-style-type: none;
  }
  ul.postlist-style-circle {
    list-style-type: circle;
  }
</style>

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../../../../../../index.html">
    <img class="logo" src="../../../../../../_static/logo.png" alt="Logo"/>
    
  </a>
</p>



<p class="blurb">Linux und Open Source</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Schulungen</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../../index.html">Kursangebot</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../../index.html">Unterlagen &amp; Download</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../../index.html">Topics</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../../python/group.html">Python Programming: From Absolute Beginner to Advanced Productivity</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../c/group.html">The C Programming Language</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cxx-todo/index.html">C++: TODO List</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cxx/group.html">C++: Miscellaneous Live-Hacking</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cxx03/group.html">C++ 03</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cxx11/group.html">C++ 11</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cxx-design-patterns/group.html">Design Patterns With C++</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cxx-code/index.html">C++ Code</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cxx-exercises/group.html">C++ Exercises</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../../group.html">Linux</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../../basics/group.html">Linux Basics</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../ssh/group.html">SSH: Secure Shell</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../toolchain/group.html">Toolchain, And Cross Development</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../sysprog/group.html">Linux Systems Programming</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="../group.html">Linux Hardware Interfaces</a><ul class="current">
<li class="toctree-l5"><a class="reference internal" href="../can/group.html">CAN Bus With Linux And Python</a></li>
<li class="toctree-l5 current"><a class="current reference internal" href="#">Linux and OneWire (using DS18B20 Temperature Sensor as Slave)</a></li>
<li class="toctree-l5"><a class="reference internal" href="../i2c/topic.html">Linux and I2C (using LM73 Temperature Sensor as Slave)</a></li>
<li class="toctree-l5"><a class="reference internal" href="../pwm/topic.html">PWM Userspace Interface (using PCA9685)</a></li>
<li class="toctree-l5"><a class="reference internal" href="../brushless-motor/topic.html">Controlling a Brushless Motor With Raspberry Pi</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../drafts/group.html">Drafts</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../unittest/group.html">Unit Testing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../kernel/group.html">Linux Kernel Driver Development</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../graph.html">Generated Topic Graph</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../org.html">Organisatorisches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../codex.html">Datenschutz</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../log/index.html">Bisher Gehaltene</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../about/myself/index.html">Über Mich</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../about/site/index.html">About This Site</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Blog</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../blog/index.html">Posts</a></li>
</ul>


        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
             <section id="linux-and-onewire-using-ds18b20-temperature-sensor-as-slave">
<h1>Linux and OneWire (using DS18B20 Temperature Sensor as Slave)<a class="headerlink" href="#linux-and-onewire-using-ds18b20-temperature-sensor-as-slave" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#overview" id="id10">Overview</a></p></li>
<li><p><a class="reference internal" href="#master-device-alterative-1-w1-gpio-onewire-master-in-software" id="id11">Master Device, Alterative 1: <code class="docutils literal notranslate"><span class="pre">w1-gpio</span></code> - OneWire Master in Software</a></p>
<ul>
<li><p><a class="reference internal" href="#wiring-attach-onewire-device-to-gpio-pin" id="id12">Wiring: Attach OneWire Device to GPIO Pin</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#master-device-alterative-2-ds2482-i2c-onewire-master-in-hardware" id="id13">Master Device, Alterative 2: DS2482 - I2C OneWire Master in Hardware</a></p>
<ul>
<li><p><a class="reference internal" href="#id1" id="id14">Overview</a></p></li>
<li><p><a class="reference internal" href="#wiring-attach-ds2482-800-via-i2c" id="id15">Wiring: Attach DS2482-800 via I2C</a></p></li>
<li><p><a class="reference internal" href="#configure-software" id="id16">Configure Software</a></p>
<ul>
<li><p><a class="reference internal" href="#enable-i2c-and-check" id="id17">Enable I2C, and Check</a></p></li>
<li><p><a class="reference internal" href="#verify-that-our-device-is-there" id="id18">Verify That Our Device Is There</a></p></li>
<li><p><a class="reference internal" href="#announce-hotplug-ds2482-to-linux" id="id19">Announce (“Hotplug”) DS2482 to Linux</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#wiring-attach-onewire-device-to-ds2482-800" id="id20">Wiring: Attach OneWire Device to DS2482-800</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#over-engineering-beauty" id="id21">Over-Engineering? Beauty?</a></p>
<ul>
<li><p><a class="reference internal" href="#hardware-bringup" id="id22">Hardware Bringup</a></p></li>
<li><p><a class="reference internal" href="#device-usage" id="id23">Device Usage</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#slave-device-ds18b20-temperature-sensor" id="id24">Slave Device: DS18B20 Temperature Sensor</a></p>
<ul>
<li><p><a class="reference internal" href="#using-the-device" id="id25">Using the Device</a></p>
<ul>
<li><p><a class="reference internal" href="#as-a-generic-onewire-device" id="id26">As a Generic OneWire Device</a></p></li>
<li><p><a class="reference internal" href="#as-a-hardware-monitoring-hwmon-device" id="id27">As a Hardware Monitoring (<code class="docutils literal notranslate"><span class="pre">hwmon</span></code>) Device</a></p></li>
<li><p><a class="reference internal" href="#lm-sensors" id="id28"><code class="docutils literal notranslate"><span class="pre">lm-sensors</span></code></a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#onewire-caveats" id="id29">OneWire Caveats</a></p>
<ul>
<li><p><a class="reference internal" href="#bus-topology" id="id30">Bus Topology</a></p></li>
<li><p><a class="reference internal" href="#error-symptoms" id="id31">Error Symptoms</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#links" id="id32">Links</a></p></li>
</ul>
</div>
<section id="overview">
<h2><a class="toc-backref" href="#id10">Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>This article shows how you use Linux to communicate with <a class="reference external" href="https://en.wikipedia.org/wiki/1-Wire">OneWire</a> devices. Cornerstones are:</p>
<ul class="simple">
<li><p>Master, Alternative 1: <code class="docutils literal notranslate"><span class="pre">w1-gpio</span></code> - bus master in software (unstable at
times)</p></li>
<li><p>Master, Alternative 2: <a class="reference external" href="https://www.maximintegrated.com/en/products/interface/controllers-expanders/DS2482-800.html">DS2482</a> -
bus master in hardware, attached to the CPU via I2C</p></li>
<li><p>Slave <a class="reference external" href="https://www.maximintegrated.com/en/products/DS18B20">DS18B20</a> OneWire
temperature sensor as a slave device.</p></li>
<li><p>Rasperry Pi because everything’s easy there. This article’s
principles stand unmodified for other platforms that run Linux (more
handwork might be needed though - Pi’s <code class="docutils literal notranslate"><span class="pre">/boot/config.txt</span></code> is
really cool, for example).</p></li>
</ul>
<p>A <a class="reference external" href="https://en.wikipedia.org/wiki/1-Wire">OneWire</a> device has three
wires attached to it: data, ground, and power. Data and ground are
mandatory, obviously. Power is optional; if omitted, the device is
said to be operated in <em>parasitic mode</em>.</p>
</section>
<section id="master-device-alterative-1-w1-gpio-onewire-master-in-software">
<h2><a class="toc-backref" href="#id11">Master Device, Alterative 1: <code class="docutils literal notranslate"><span class="pre">w1-gpio</span></code> - OneWire Master in Software</a><a class="headerlink" href="#master-device-alterative-1-w1-gpio-onewire-master-in-software" title="Permalink to this headline">¶</a></h2>
<p>Lacking a hardware OneWire master (the Raspi does not have one
built-in), we use a software implementation of the OneWire protocol -
the <code class="docutils literal notranslate"><span class="pre">w1-gpio</span></code> kernel driver. You configure one GPIO to act as the
data line, and the kernel driver is then used to <a class="reference external" href="https://en.wikipedia.org/wiki/Bit_banging">bitbang</a> the OneWire protocol in
and out of the CPU.</p>
<p>Configuration is easy: say you want to use GPIO 21 as data line. In
<code class="docutils literal notranslate"><span class="pre">/boot/config.txt</span></code> you write,</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">dtoverlay=w1-gpio,gpiopin=21</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Reboot the Pi, and the kernel will load the driver and configure
the GPIO accordingly.</p>
</div>
<section id="wiring-attach-onewire-device-to-gpio-pin">
<span id="bitbang-device"></span><h3><a class="toc-backref" href="#id12">Wiring: Attach OneWire Device to GPIO Pin</a><a class="headerlink" href="#wiring-attach-onewire-device-to-gpio-pin" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Though not exactly necessary 😉, it makes sense to halt and
power off the Pi before connecting the sensor.</p>
</div>
<table class="docutils align-left">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Professional Diagram</p></th>
<th class="head"><p>Decadent Pi Addon</p></th>
<th class="head"><p>Raspi Pinout</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><img alt="../../../../../../_images/wiring.png" src="../../../../../../_images/wiring.png" />
</td>
<td><img alt="../../../../../../_images/wiring-photo.jpg" src="../../../../../../_images/wiring-photo.jpg" />
</td>
<td><a class="reference internal image-reference" href="../../../../../../_images/raspi-pinout.png"><img alt="../../../../../../_images/raspi-pinout.png" src="../../../../../../_images/raspi-pinout.png" style="width: 619.0px; height: 356.0px;" /></a>
</td>
</tr>
</tbody>
</table>
<p>When done, reboot and see the device appear in <code class="docutils literal notranslate"><span class="pre">sysfs</span></code>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ls -l /sys/bus/w1/devices/
<span class="go">total 0</span>
<span class="go">lrwxrwxrwx 1 root root 0 Oct 26 09:58 28-01144fe43baa -&gt; ../../../devices/w1_bus_master8/28-01144fe43baa</span>
<span class="go">lrwxrwxrwx 1 root root 0 Oct 26 09:58 w1_bus_master1 -&gt; ../../../devices/w1_bus_master1</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Especially in breadboard setups, the bitbanging master appears to
become unstable. Devices are not recognized at all, or appear as
random garbage. Here’s one exceptionally amazing crap that I once
encountered - <em>one</em> device appearing as <em>two bogus</em> devices,</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ls -l /sys/bus/w1/devices
<span class="go">total 0</span>
<span class="go">drwxr-xr-x 2 root root 0 Oct 25 17:56 .</span>
<span class="go">drwxr-xr-x 4 root root 0 Oct 25 17:56 ..</span>
<span class="go">lrwxrwxrwx 1 root root 0 Oct 26 08:02 00-400000000000 -&gt; ../../../devices/w1_bus_master1/00-400000000000</span>
<span class="go">lrwxrwxrwx 1 root root 0 Oct 26 08:02 00-800000000000 -&gt; ../../../devices/w1_bus_master1/00-800000000000</span>
<span class="go">lrwxrwxrwx 1 root root 0 Oct 25 17:56 w1_bus_master1 -&gt; ../../../devices/w1_bus_master1</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="#error-symptoms"><span class="std std-ref">below</span></a> for more about OneWire errors.</p>
</div>
</section>
</section>
<section id="master-device-alterative-2-ds2482-i2c-onewire-master-in-hardware">
<h2><a class="toc-backref" href="#id13">Master Device, Alterative 2: DS2482 - I2C OneWire Master in Hardware</a><a class="headerlink" href="#master-device-alterative-2-ds2482-i2c-onewire-master-in-hardware" title="Permalink to this headline">¶</a></h2>
<aside class="sidebar">
<p class="sidebar-title">DS2482-800: 8-Channel 1-Wire Master</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.maximintegrated.com/en/products/interface/controllers-expanders/DS2482-800.html">Product page</a></p></li>
<li><p><a class="reference external" href="https://datasheets.maximintegrated.com/en/ds/DS2482-800.pdf">Datasheet (PDF)</a></p></li>
</ul>
</aside>
<section id="id1">
<h3><a class="toc-backref" href="#id14">Overview</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>The <a class="reference external" href="https://www.maximintegrated.com/en/products/interface/controllers-expanders/DS2482-800.html">DS2482</a>
is an I2C device - <em>an I2C slave device</em> - that acts as a OneWire
<em>master</em>. It implements the OneWire protocol <em>in hardware</em>, and
receives commands from the CPU on behalf of a dedicated driver.</p></li>
<li><p>Being an I2C device, we configure it just like any other I2C
device. See <a class="reference internal" href="../i2c/topic.html"><span class="doc">Linux and I2C (using LM73 Temperature Sensor as Slave)</span></a> for how I2C devices are configured
on Linux.</p></li>
<li><p>Once DS2482 is configured, we can attach our OneWire device(s) to
it.</p></li>
</ul>
</section>
<section id="wiring-attach-ds2482-800-via-i2c">
<h3><a class="toc-backref" href="#id15">Wiring: Attach DS2482-800 via I2C</a><a class="headerlink" href="#wiring-attach-ds2482-800-via-i2c" title="Permalink to this headline">¶</a></h3>
<p>The DS2482-800 is an I2C device just like any other I2C device, so we
attach it just like any other. Here’s the pinout, together with the
Raspberry header for convenience:</p>
<table class="docutils align-left">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>DS2482-800 pinout</p></th>
<th class="head"><p>Raspberry 40-pin header pinout</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><img alt="../../../../../../_images/DS2482-800-pinout.png" src="../../../../../../_images/DS2482-800-pinout.png" />
</td>
<td><img alt="../../../../../../_images/raspi-pinout.png" src="../../../../../../_images/raspi-pinout.png" />
</td>
</tr>
</tbody>
</table>
<p>Connect pins as follows:</p>
<table class="docutils align-left">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>DS2482-800</p></th>
<th class="head"><p>Raspberry</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">AD0</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">GND</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">AD1</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">GND</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">AD2</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">GND</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">SDA</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">GPIO</span> <span class="pre">2</span> <span class="pre">(SDA)</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">SCL</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">GPIO</span> <span class="pre">3</span> <span class="pre">(SCL)</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">VCC</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">3V3</span> <span class="pre">power</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">GND</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Ground</span></code></p></td>
</tr>
</tbody>
</table>
<p>You may vary the assignment of the <code class="docutils literal notranslate"><span class="pre">AD*</span></code> address selection
pins. Here, we choose to wire them to ground (0) - according to the
diagram below this gives address <code class="docutils literal notranslate"><span class="pre">0x18</span></code>, or <code class="docutils literal notranslate"><span class="pre">0b0011000</span></code>.</p>
<img alt="../../../../../../_images/DS2482-800-address.png" src="../../../../../../_images/DS2482-800-address.png" />
</section>
<section id="configure-software">
<h3><a class="toc-backref" href="#id16">Configure Software</a><a class="headerlink" href="#configure-software" title="Permalink to this headline">¶</a></h3>
<p>Next, we configure software. Please read <a class="reference internal" href="../i2c/topic.html"><span class="doc">Linux and I2C (using LM73 Temperature Sensor as Slave)</span></a> for
details; here we just reproduce shortly what is explained there.</p>
<section id="enable-i2c-and-check">
<h4><a class="toc-backref" href="#id17">Enable I2C, and Check</a><a class="headerlink" href="#enable-i2c-and-check" title="Permalink to this headline">¶</a></h4>
<p>In <code class="docutils literal notranslate"><span class="pre">/boot/config.txt</span></code>, add the following line.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>dtparam=i2c_arm=on
</pre></div>
</div>
<p>Reboot and verify all is well.</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">I2C platform driver loaded?</span><a class="headerlink" href="#id5" title="Permalink to this code">¶</a></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>lsmod <span class="p">|</span>grep i2c
<span class="go">i2c_bcm2835            16384  0</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">I2C bus #1 visible in <code class="docutils literal notranslate"><span class="pre">sysfs</span></code></span><a class="headerlink" href="#id6" title="Permalink to this code">¶</a></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ls -l /sys/bus/i2c/devices/i2c-1
<span class="go">lrwxrwxrwx 1 root root 0 Oct  4 12:43 /sys/bus/i2c/devices/i2c-1 -&gt; ../../../devices/platform/soc/fe804000.i2c/i2c-1</span>
</pre></div>
</div>
</div>
</section>
<section id="verify-that-our-device-is-there">
<h4><a class="toc-backref" href="#id18">Verify That Our Device Is There</a><a class="headerlink" href="#verify-that-our-device-is-there" title="Permalink to this headline">¶</a></h4>
<p>(Optional if you are sure it is there)</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">i2c-dev</span></code> exposes bus to userspace</span><a class="headerlink" href="#id7" title="Permalink to this code">¶</a></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo modprobe i2c-dev
<span class="gp">$ </span>ls -l /dev/i2c-1
<span class="go">crw-rw---- 1 root i2c 89, 1 Sep 29 14:27 /dev/i2c-1</span>
</pre></div>
</div>
</div>
<p>Device should be there at configured address (<code class="docutils literal notranslate"><span class="pre">0x18</span></code>),</p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">i2c-detect</span></code> scans bus</span><a class="headerlink" href="#id8" title="Permalink to this code">¶</a></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>i2cdetect -y <span class="m">1</span>
<span class="go">     0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f</span>
<span class="go">00:          -- -- -- -- -- -- -- -- -- -- -- -- --</span>
<span class="go">10: -- -- -- -- -- -- -- -- 18 -- -- -- -- -- -- --</span>
<span class="go">20: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --</span>
<span class="go">30: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --</span>
<span class="go">40: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --</span>
<span class="go">50: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --</span>
<span class="go">60: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --</span>
<span class="go">70: -- -- -- -- -- -- -- --</span>
</pre></div>
</div>
</div>
</section>
<section id="announce-hotplug-ds2482-to-linux">
<h4><a class="toc-backref" href="#id19">Announce (“Hotplug”) DS2482 to Linux</a><a class="headerlink" href="#announce-hotplug-ds2482-to-linux" title="Permalink to this headline">¶</a></h4>
<p>Finally, tell Linux about the new device at address <code class="docutils literal notranslate"><span class="pre">0x18</span></code>. This
will load the responsible driver - it is that driver that is
responsible to communicate with the OneWire devices on the new buses
(the DS2482-800 bring eight buses).</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo -i
<span class="gp"># </span><span class="nb">echo</span> ds2482 0x18 &gt; /sys/bus/i2c/devices/i2c-1/new_device
<span class="gp"># </span><span class="nb">exit</span>
</pre></div>
</div>
<p>See if driver is loaded,</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>lsmod <span class="p">|</span>grep ds2482
<span class="go">ds2482                 16384  0</span>
<span class="go">wire                   36864  2 ds2482</span>
</pre></div>
</div>
<p>Eight buses there in <code class="docutils literal notranslate"><span class="pre">sysfs</span></code>,</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ls -l /sys/bus/w1/devices/
<span class="go">total 0</span>
<span class="go">lrwxrwxrwx 1 root root 0 Oct 26 09:52 w1_bus_master1 -&gt; ../../../devices/w1_bus_master1</span>
<span class="go">lrwxrwxrwx 1 root root 0 Oct 26 09:52 w1_bus_master2 -&gt; ../../../devices/w1_bus_master2</span>
<span class="go">lrwxrwxrwx 1 root root 0 Oct 26 09:52 w1_bus_master3 -&gt; ../../../devices/w1_bus_master3</span>
<span class="go">lrwxrwxrwx 1 root root 0 Oct 26 09:52 w1_bus_master4 -&gt; ../../../devices/w1_bus_master4</span>
<span class="go">lrwxrwxrwx 1 root root 0 Oct 26 09:52 w1_bus_master5 -&gt; ../../../devices/w1_bus_master5</span>
<span class="go">lrwxrwxrwx 1 root root 0 Oct 26 09:52 w1_bus_master6 -&gt; ../../../devices/w1_bus_master6</span>
<span class="go">lrwxrwxrwx 1 root root 0 Oct 26 09:52 w1_bus_master7 -&gt; ../../../devices/w1_bus_master7</span>
<span class="go">lrwxrwxrwx 1 root root 0 Oct 26 09:52 w1_bus_master8 -&gt; ../../../devices/w1_bus_master8</span>
</pre></div>
</div>
</section>
</section>
<section id="wiring-attach-onewire-device-to-ds2482-800">
<h3><a class="toc-backref" href="#id20">Wiring: Attach OneWire Device to DS2482-800</a><a class="headerlink" href="#wiring-attach-onewire-device-to-ds2482-800" title="Permalink to this headline">¶</a></h3>
<p>Finally, in analogy to <a class="reference internal" href="#bitbang-device"><span class="std std-ref">wiring a device to the bitbanging master</span></a>, we now wire our OneWire device to DS2482. Connect
the device’s data line to any of DS2482-800’s <code class="docutils literal notranslate"><span class="pre">IO*</span></code> pins, and supply
power and ground.</p>
<table class="docutils align-left">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>OneWire device</p></th>
<th class="head"><p>DS2482-800</p></th>
<th class="head"><p>Raspberry</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Data</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">IO*</span></code></p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>VCC</p></td>
<td></td>
<td><p>3V3</p></td>
</tr>
<tr class="row-even"><td><p>Ground</p></td>
<td></td>
<td><p>Ground</p></td>
</tr>
</tbody>
</table>
<p>Reboot, and see the device appear in <code class="docutils literal notranslate"><span class="pre">sysfs</span></code>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ls -l /sys/bus/w1/devices/
<span class="go">total 0</span>
<span class="go">lrwxrwxrwx 1 root root 0 Oct 26 09:58 28-01144fe43baa -&gt; ../../../devices/w1_bus_master8/28-01144fe43baa</span>
<span class="go">lrwxrwxrwx 1 root root 0 Oct 26 09:58 w1_bus_master1 -&gt; ../../../devices/w1_bus_master1</span>
<span class="go">lrwxrwxrwx 1 root root 0 Oct 26 09:58 w1_bus_master2 -&gt; ../../../devices/w1_bus_master2</span>
<span class="go">lrwxrwxrwx 1 root root 0 Oct 26 09:58 w1_bus_master3 -&gt; ../../../devices/w1_bus_master3</span>
<span class="go">lrwxrwxrwx 1 root root 0 Oct 26 09:58 w1_bus_master4 -&gt; ../../../devices/w1_bus_master4</span>
<span class="go">lrwxrwxrwx 1 root root 0 Oct 26 09:58 w1_bus_master5 -&gt; ../../../devices/w1_bus_master5</span>
<span class="go">lrwxrwxrwx 1 root root 0 Oct 26 09:58 w1_bus_master6 -&gt; ../../../devices/w1_bus_master6</span>
<span class="go">lrwxrwxrwx 1 root root 0 Oct 26 09:58 w1_bus_master7 -&gt; ../../../devices/w1_bus_master7</span>
<span class="go">lrwxrwxrwx 1 root root 0 Oct 26 09:58 w1_bus_master8 -&gt; ../../../devices/w1_bus_master8</span>
</pre></div>
</div>
</section>
</section>
<section id="over-engineering-beauty">
<h2><a class="toc-backref" href="#id21">Over-Engineering? Beauty?</a><a class="headerlink" href="#over-engineering-beauty" title="Permalink to this headline">¶</a></h2>
<p>What happened so far sounds complicated, and it is.</p>
<section id="hardware-bringup">
<h3><a class="toc-backref" href="#id22">Hardware Bringup</a><a class="headerlink" href="#hardware-bringup" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>All the wiring</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">w1-gpio</span></code> configuration in <code class="docutils literal notranslate"><span class="pre">/boot/config.txt</span></code></p></li>
<li><p>I2C configuration in <code class="docutils literal notranslate"><span class="pre">/boot/config.txt</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">echo</span> <span class="pre">ds2482</span> <span class="pre">0x18</span> <span class="pre">&gt;</span> <span class="pre">/sys/bus/i2c/devices/i2c-1/new_device</span></code> to load a driver</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lsmod</span></code></p></li>
<li><p>All the files in <code class="docutils literal notranslate"><span class="pre">sysfs</span></code></p></li>
</ul>
<p>All in all, this is hardware bringup. Using a DS2482, for example,
requires</p>
<ul class="simple">
<li><p>a running I2C bus</p></li>
<li><p>code that can communicate with DS2482</p></li>
<li><p>code that can interpret DS2482’s OneWire talk</p></li>
</ul>
<p>In traditional embedded platforms, running traditional embedded
operating systems, one would have to write code to configure the
system in such a way.</p>
<p>Linux has <em>abstractions</em>. My favorite abstraction is <em>“Everything is a
file”</em>, and that is used heavily here. No matter what hardware
platform, in Linux I2C slaves are added by writing `` ds2482 0x18``
into <code class="docutils literal notranslate"><span class="pre">/sys/bus/i2c/devices/i2c-&lt;busno&gt;/new_device</span></code>, and <em>existing
code</em> is loaded in the form of a kernel module (a “driver”).</p>
<p>In Linux, OneWire devices are represented as directories
(<code class="docutils literal notranslate"><span class="pre">/sys/bus/w1/devices/28-01144fe43baa</span></code>), no matter if you use a
software/bitbanging master or if the master is implemented in hardware
<a class="footnote-reference brackets" href="#w1-cpu" id="id2">2</a>.</p>
<p>This is exactly the separation of concerns that Linux
enforces. Hardware bringup is the responsibility of the <em>kernel</em> (and
the bootloader, for that matter).</p>
</section>
<section id="device-usage">
<h3><a class="toc-backref" href="#id23">Device Usage</a><a class="headerlink" href="#device-usage" title="Permalink to this headline">¶</a></h3>
<p>Once the hardware is configured to this point (the kernel has booted,
drivers are loaded), the devices can be used <em>without any knowledge of
the underlying hardware</em>.</p>
<p>The Linux OneWire interface makes heavy use of the file abtraction,
which is good because everything that someone who wants to read
temperatures from OneWire sensors, for example, has to know is how to
read a file, and which.</p>
<p>See the <a class="reference external" href="https://www.kernel.org/doc/html/latest/w1/w1-generic.html">Kernel OneWire documentation</a> for
details of the OneWire interface.</p>
<p>What follows is a walk-through of how to deal with a specific OneWire
device, the DS18B20 temperature sensor. View it as a placeholder for
any other such device.</p>
</section>
</section>
<section id="slave-device-ds18b20-temperature-sensor">
<h2>Slave Device: <a class="reference external" href="https://www.maximintegrated.com/en/products/DS18B20">DS18B20</a> Temperature Sensor<a class="headerlink" href="#slave-device-ds18b20-temperature-sensor" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-left">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>The <a class="reference external" href="https://www.maximintegrated.com/en/products/DS18B20">DS18B20</a>
OneWire temperature sensor is a popular device. You can find
parts that come prepackaged in a metal case; these are still
affordable, and really easy to deploy.</p></td>
<td><figure class="align-left">
<img alt="DS18B20 (packaged)" src="../../../../../../_images/ds18b20-packaged.jpg" />
</figure>
</td>
</tr>
</tbody>
</table>
<section id="using-the-device">
<h3><a class="toc-backref" href="#id25">Using the Device</a><a class="headerlink" href="#using-the-device" title="Permalink to this headline">¶</a></h3>
<p>In most if not all cases, Linux presents hardware as a set of regular
files in <code class="docutils literal notranslate"><span class="pre">sysfs</span></code>. Read on for how.</p>
<section id="as-a-generic-onewire-device">
<h4><a class="toc-backref" href="#id26">As a Generic OneWire Device</a><a class="headerlink" href="#as-a-generic-onewire-device" title="Permalink to this headline">¶</a></h4>
<p>OneWire masters automatically enumerate their buses, by definition -
so our device should show up automatically in a dedicated directory
<code class="docutils literal notranslate"><span class="pre">/sys/bus/w1/devices/&lt;manufacturer&gt;-&lt;device-address&gt;</span></code>. (If all is
well; see below for caveats.)</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ls -l /sys/bus/w1/devices/28-01144fe43baa/
<span class="go">total 0</span>
<span class="go">-rw-r--r-- 1 root root 4096 Sep 22 12:19 alarms</span>
<span class="go">-rw-r--r-- 1 root root 4096 Sep 22 12:19 conv_time</span>
<span class="go">lrwxrwxrwx 1 root root    0 Sep 22 12:19 driver -&gt; ../../../bus/w1/drivers/w1_slave_driver</span>
<span class="go">--w------- 1 root root 4096 Sep 22 12:19 eeprom</span>
<span class="go">-r--r--r-- 1 root root 4096 Sep 22 12:19 ext_power</span>
<span class="go">-rw-r--r-- 1 root root 4096 Sep 22 12:19 features</span>
<span class="go">drwxr-xr-x 3 root root    0 Sep 22 12:16 hwmon</span>
<span class="go">-r--r--r-- 1 root root 4096 Sep 22 12:19 id</span>
<span class="go">-r--r--r-- 1 root root 4096 Sep 22 12:19 name</span>
<span class="go">drwxr-xr-x 2 root root    0 Sep 22 12:19 power</span>
<span class="go">-rw-r--r-- 1 root root 4096 Sep 22 12:19 resolution</span>
<span class="go">lrwxrwxrwx 1 root root    0 Sep 22 12:16 subsystem -&gt; ../../../bus/w1</span>
<span class="go">-r--r--r-- 1 root root 4096 Sep 22 12:19 temperature</span>
<span class="go">-rw-r--r-- 1 root root 4096 Sep 22 12:16 uevent</span>
<span class="go">-rw-r--r-- 1 root root 4096 Sep 22 12:19 w1_slave</span>
</pre></div>
</div>
<p>A file that is common to all OneWire devices (not only temperature
sensors) is <code class="docutils literal notranslate"><span class="pre">w1_slave</span></code>, which already contains all we need: the
temperature in milli-celsius (22750).</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>cat /sys/bus/w1/devices/28-01144fe43baa/w1_slave
<span class="go">6c 01 4b 46 7f ff 0c 10 2b : crc=2b YES</span>
<span class="go">6c 01 4b 46 7f ff 0c 10 2b t=22750</span>
</pre></div>
</div>
</section>
<section id="as-a-hardware-monitoring-hwmon-device">
<h4><a class="toc-backref" href="#id27">As a Hardware Monitoring (<code class="docutils literal notranslate"><span class="pre">hwmon</span></code>) Device</a><a class="headerlink" href="#as-a-hardware-monitoring-hwmon-device" title="Permalink to this headline">¶</a></h4>
<p>A different aspect to our sensor, DS18B20, is that it is a temperature
sensor - independent of which hardware it is. There is an entire
framework inside the kernel, <code class="docutils literal notranslate"><span class="pre">hwmon</span></code>, to cover such devices - no
matter if they are OneWire or I2C (or …)  devices, or if they are
reachable via a CPU internal bus.</p>
<p>As such (a temperature sensor), the device appears under an
alternative location in <code class="docutils literal notranslate"><span class="pre">sysfs</span></code>,</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ls -l /sys/class/hwmon/hwmon1/
<span class="go">total 0</span>
<span class="go">lrwxrwxrwx 1 root root    0 Sep 22 14:44 device -&gt; ../../../28-01144fe43baa</span>
<span class="go">-r--r--r-- 1 root root 4096 Sep 22 14:44 name</span>
<span class="go">drwxr-xr-x 2 root root    0 Sep 22 14:44 power</span>
<span class="go">lrwxrwxrwx 1 root root    0 Sep 22 14:44 subsystem -&gt; ../../../../../class/hwmon</span>
<span class="go">-r--r--r-- 1 root root 4096 Sep 22 14:44 temp1_input</span>
<span class="go">-rw-r--r-- 1 root root 4096 Sep 22 12:16 uevent</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">temp1_input</span></code> is what contains information for us (again, the
temperature in milli-celsius):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>cat /sys/class/hwmon/hwmon1/temp1_input
<span class="go">22750</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul>
<li><p><strong>Question</strong>: how do I know that it’s my sensor in <code class="docutils literal notranslate"><span class="pre">hwmon1</span></code>?
<code class="docutils literal notranslate"><span class="pre">hwmon1</span></code> seems like a randomly/sequentially chosen name, and I
assume the order is not always the same across boots.</p></li>
<li><p><strong>Answer</strong>: correct. But the address of the sensor (that is how
you identify your devices in the end) is globally unique. You can
use that to find the correct <code class="docutils literal notranslate"><span class="pre">/sys/class/hwmon/</span></code> subdirectory.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ls -l /sys/class/hwmon/hwmon1/device
<span class="go">lrwxrwxrwx 1 root root 0 Sep 22 14:44 /sys/class/hwmon/hwmon1/device -&gt; ../../../28-01144fe43baa</span>
</pre></div>
</div>
</li>
</ul>
</div>
</section>
<section id="lm-sensors">
<h4><a class="toc-backref" href="#id28"><code class="docutils literal notranslate"><span class="pre">lm-sensors</span></code></a><a class="headerlink" href="#lm-sensors" title="Permalink to this headline">¶</a></h4>
<p>It is the <code class="docutils literal notranslate"><span class="pre">hwmon</span></code> hardware-independent sensor interface that the
userspace <code class="docutils literal notranslate"><span class="pre">lm-sensors</span></code> framework builds upon. (<a class="reference external" href="https://github.com/lm-sensors/lm-sensors">Github</a>, <a class="reference external" href="https://en.wikipedia.org/wiki/Lm_sensors">Wikipedia</a>.)</p>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text">Installation (on the Raspi)</span><a class="headerlink" href="#id9" title="Permalink to this code">¶</a></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>apt install lm-sensors
</pre></div>
</div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>sensors
<span class="go">rpi_volt-isa-0000</span>
<span class="go">Adapter: ISA adapter</span>
<span class="go">in0:              N/A</span>

<span class="go">cpu_thermal-virtual-0</span>
<span class="go">Adapter: Virtual device</span>
<span class="go">temp1:        +50.1°C</span>

<span class="go">w1_slave_temp-virtual-0</span>
<span class="go">Adapter: Virtual device</span>
<span class="go">temp1:        +21.4°C</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="onewire-caveats">
<h2><a class="toc-backref" href="#id29">OneWire Caveats</a><a class="headerlink" href="#onewire-caveats" title="Permalink to this headline">¶</a></h2>
<section id="bus-topology">
<h3><a class="toc-backref" href="#id30">Bus Topology</a><a class="headerlink" href="#bus-topology" title="Permalink to this headline">¶</a></h3>
<p>For stability, a OneWire setup should not exhibit a star
topology. Rather, it is best to have one long main line, with only
very short branches off of it where the sensors are attached.</p>
<p>Maxim Integrated has a tutorial, <a class="reference external" href="https://www.maximintegrated.com/en/app-notes/index.mvp/id/148">Guidelines for Reliable Long Line
1-Wire Networks</a>. There
they define the terms <em>radious</em> and <em>weight</em>; it is definitely worth
reading.</p>
</section>
<section id="error-symptoms">
<span id="id3"></span><h3><a class="toc-backref" href="#id31">Error Symptoms</a><a class="headerlink" href="#error-symptoms" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p><strong>Devices disappear</strong>, and are replaced by ones that are named like
<code class="docutils literal notranslate"><span class="pre">00-0c4000000000</span></code>. Here, <code class="docutils literal notranslate"><span class="pre">00</span></code> is the family which is completely
bogus; for example, 28 (hex) would be the expected family. (I
believe 0x28 stands for “Dallas”).</p></li>
<li><p><strong>Reading fails a CRC check</strong>,</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>cat /sys/bus/w1/devices/28-02131d9920aa/w1_slave
<span class="go">20 01 4b 46 7f ff 0c 10 5d : crc=5d NO</span>
<span class="go">20 01 4b 46 7f ff 0c 10 5d t=18000</span>
</pre></div>
</div>
</li>
<li><p><strong>Reading gives me a temperature of 0 degrees.</strong></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>cat /sys/bus/w1/devices/28-011432f138f9/w1_slave
<span class="go">00 00 00 00 00 00 00 00 00 : crc=00 YES</span>
<span class="go">00 00 00 00 00 00 00 00 00 t=0</span>
</pre></div>
</div>
<p>This is the worst thermometer error you can encounter because it
does not declare himself as such. One can imagine what sorts of
heating control misbehavior a room temperature of zero degrees would
cause.</p>
</li>
</ul>
<p>In my experience <a class="footnote-reference brackets" href="#not-a-hw-guy" id="id4">1</a>, the bitbanging driver is only good
for the most trivial setups. As soon as you have a larger
installation, you’ll see errors of the above sort over and over.</p>
<p>Over time, I was able to reduce the instabilities by cutting the
initial star topology down to what I describe above. Still, there were
some glitches from time to time. I blame those on the bitbanging in
software. OneWire is a slow and easy protocol, but there are still
timing constraints that might not be met in some cases.</p>
<p>Sure, I could have tried the Linux realtime options to get better
response and timing guarantees. On the other hand, heating control is
something that is exactly the opposite of realtime. If a pump is
turned on a minute too late, still nothing burns down - this is not a
nuclear power plant.</p>
<p>So no: no realtime wanted. Especially because it would have been just
another tryout.</p>
</section>
</section>
<section id="links">
<h2><a class="toc-backref" href="#id32">Links</a><a class="headerlink" href="#links" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/1-Wire">OneWire (WikiPedia)</a></p></li>
<li><p><a class="reference external" href="https://www.maximintegrated.com/en/app-notes/index.mvp/id/148">Guidelines for Reliable Long Line 1-Wire Networks</a></p></li>
<li><p><a class="reference external" href="https://www.kernel.org/doc/html/latest/w1/w1-generic.html">Kernel OneWire Documentation</a></p></li>
<li><p><a class="reference external" href="https://www.maximintegrated.com/en/products/DS18B20">DS18B20 Temperature Sensor</a></p></li>
<li><p><a class="reference external" href="https://www.maximintegrated.com/en/products/interface/controllers-expanders/DS2482-800.html">DS2482-800 I2C 8-Channel OneWire Master</a></p></li>
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Bit_banging">Bitbanging</a></p></li>
<li><p><a class="reference external" href="https://github.com/lm-sensors/lm-sensors">lm-sensors on Github</a></p></li>
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Lm_sensors">lm-sensors on Wikipedia</a></p></li>
</ul>
<p class="rubric">Footnotes</p>
<dl class="footnote brackets">
<dt class="label" id="not-a-hw-guy"><span class="brackets"><a class="fn-backref" href="#id4">1</a></span></dt>
<dd><p>I am not a hardware expert.</p>
</dd>
<dt class="label" id="w1-cpu"><span class="brackets"><a class="fn-backref" href="#id2">2</a></span></dt>
<dd><p>The Raspberry CPU has no OneWire master built-in, but
there are SoC’s out there which have. Linux support for
these CPUs means that someone has implemented a driver
for that master, just like there is a driver for the
external DS2482 add-on.</p>
</dd>
</dl>
</section>
</section>

<div class="section">
   
</div>

          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2019-2023 (GPLv3), Jörg Faschingbauer.
      
      |
      <a href="../../../../../../_sources/trainings/material/soup/linux/hardware/w1/topic.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>