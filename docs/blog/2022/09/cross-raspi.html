<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta content="crosstool-ng - built Raspberry Pi Cross Toolchain" name="description" />
<meta content="cross development, raspberry pi, linux, crosstool-ng, gcc, c++" name="keywords" />

    <title>Building A Cross Toolchain For The Raspberry Pi, Using crosstool-ng &#8212; Jörg Faschingbauer</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=cf071e93" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/jf-alabaster.css?v=70eaaddc" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinxcontrib-images/LightBox2/lightbox2/dist/css/lightbox.css?v=5c84f910" />
    <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/thebelab-helper.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../_static/sphinxcontrib-images/LightBox2/lightbox2/dist/js/lightbox-plus-jquery.min.js?v=ffc8af2d"></script>
    <script src="../../../_static/sphinxcontrib-images/LightBox2/lightbox2-customize/jquery-noconflict.js?v=12818e64"></script>
    <link rel="canonical" href="https://www.faschingbauer.me/blog/2022/09/cross-raspi.html" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />

   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  

  
  


<link
  rel="alternate"
  type="application/atom+xml"
  href="../../../blog/atom.xml"
  title="Jörg Faschingbauer"
/>


<link href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css" rel="stylesheet"/>


  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../../../index.html">
    <img class="logo" src="../../../_static/logo.png" alt="Logo" />
    
  </a>
</p>



<p class="blurb">Programming Linux</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Courses</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../trainings/index.html">Courses Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../trainings/material/soup/index.html">Slide Material</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../trainings/booking.html">How To Book</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../trainings/log/index.html">Log Of Past Courses</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../about/myself/index.html">Myself: Contact, Impressum, …</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../about/site/index.html">This Site</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Blog</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Posts</a></li>
</ul>


<div class="ablog-sidebar-item ablog__postcard">


<h2>
  
  
  <i class="fa fa-calendar"></i>
  
  2022-09-23
  
</h2>
<ul>
  <div class="ablog-sidebar-item ablog__postcard2">


<li id="ablog-sidebar-item author ablog__author">
  <span>
    
    <i class="fa-fw fa fa-user"></i>
    
    </span>
  
  
  <a href="../../author/jorg-faschingbauer.html">Jörg Faschingbauer</a>
  
  
  
</li>


<li id="ablog-sidebar-item location ablog__location">
  <span>
    
    <i class="fa-fw fa fa-location-arrow"></i>
    
    </span>
  
  
  <a href="../../location/graz-austria.html">Graz, Austria</a>
  
  
  
</li>


<li id="ablog-sidebar-item language ablog__language">
  <span>
    
    <i class="fa-fw fa fa-language"></i>
    
    </span>
  
  
  <a href="../../language/en.html">en</a>
  
  
  
</li>


<li id="ablog-sidebar-item category ablog__category">
  <span>
    
    <i class="fa-fw fa fa-folder-open"></i>
    
    </span>
  
  
  <a href="../../category/linux.html">linux</a>
  
  ,
  
  
  
  
  <a href="../../category/raspberry.html">raspberry</a>
  
  ,
  
  
  
  
  <a href="../../category/embedded.html">embedded</a>
  
  
  
</li>



</div>
</ul>
</div>

        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
<section id="building-a-cross-toolchain-for-the-raspberry-pi-using-crosstool-ng">
<h1>Building A Cross Toolchain For The Raspberry Pi, Using <code class="docutils literal notranslate"><span class="pre">crosstool-ng</span></code><a class="headerlink" href="#building-a-cross-toolchain-for-the-raspberry-pi-using-crosstool-ng" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#why-this-article-why-not-use-a-prebuilt-toolchain" id="id13">Why This Article? Why Not Use A Prebuilt Toolchain?</a></p></li>
<li><p><a class="reference internal" href="#installing-crosstool-ng" id="id14">Installing <code class="docutils literal notranslate"><span class="pre">crosstool-ng</span></code></a></p>
<ul>
<li><p><a class="reference internal" href="#prerequisites" id="id15">Prerequisites</a></p></li>
<li><p><a class="reference internal" href="#installing-from-cloned-git-repository" id="id16">Installing From Cloned Git Repository</a></p></li>
<li><p><a class="reference internal" href="#installing-from-release-tarball" id="id17">Installing From Release Tarball</a></p></li>
<li><p><a class="reference internal" href="#path-and-basic-test" id="id18"><code class="docutils literal notranslate"><span class="pre">PATH</span></code>, And Basic Test</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#configure-toolchain-build" id="id19">Configure Toolchain Build</a></p>
<ul>
<li><p><a class="reference internal" href="#base-configuration-for-the-raspberry" id="id20">Base Configuration For The Raspberry</a></p></li>
<li><p><a class="reference internal" href="#important-glibc-version" id="id21">Important: <code class="docutils literal notranslate"><span class="pre">glibc</span></code> Version</a></p>
<ul>
<li><p><a class="reference internal" href="#the-error" id="id22">The Error</a></p></li>
<li><p><a class="reference internal" href="#the-fix" id="id23">The Fix</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#important-gcc-version" id="id24">Important: GCC Version</a></p>
<ul>
<li><p><a class="reference internal" href="#id4" id="id25">The Error</a></p></li>
<li><p><a class="reference internal" href="#id5" id="id26">The Fix</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#toolchain-build-install" id="id27">Toolchain Build/Install</a></p></li>
<li><p><a class="reference internal" href="#test" id="id28">Test</a></p>
<ul>
<li><p><a class="reference internal" href="#simplest-c-stdio-h" id="id29">Simplest: C, <code class="docutils literal notranslate"><span class="pre">&lt;stdio.h&gt;</span></code></a></p></li>
<li><p><a class="reference internal" href="#c-iostream" id="id30">C++, <code class="docutils literal notranslate"><span class="pre">&lt;iostream&gt;</span></code></a></p></li>
<li><p><a class="reference internal" href="#c-thread" id="id31">C++, <code class="docutils literal notranslate"><span class="pre">&lt;thread&gt;</span></code></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#packaging-distributing-the-toolchain" id="id32">Packaging/Distributing The Toolchain</a></p></li>
<li><p><a class="reference internal" href="#afterword" id="id33">Afterword</a></p></li>
</ul>
</nav>
<section id="why-this-article-why-not-use-a-prebuilt-toolchain">
<h2><a class="toc-backref" href="#id13" role="doc-backlink">Why This Article? Why Not Use A Prebuilt Toolchain?</a><a class="headerlink" href="#why-this-article-why-not-use-a-prebuilt-toolchain" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>There <a class="reference external" href="https://github.com/raspberrypi/tools">used to be</a> a
toolchain for the Raspberry Pi, made by the <a class="reference external" href="https://www.raspberrypi.com/software/">Raspberry Pi OS</a> creators. Sadly, this
repository has been dead since years.</p></li>
<li><p>One popular toolchain, <a class="reference external" href="https://snapshots.linaro.org/gnu-toolchain/">Linaro</a>, is widely
recommended for the Raspberry. It does not work for C++ though - its
<code class="docutils literal notranslate"><span class="pre">libstdc++</span></code> has an unsatisfied version dependency on
<code class="docutils literal notranslate"><span class="pre">libpthread</span></code>.</p></li>
<li><p>A number of other Raspberry toolchains exist out there, but I either
didn’t get them to work at all (see the <code class="docutils literal notranslate"><span class="pre">glibc</span></code> <a class="reference internal" href="#glibc-version"><span class="std std-ref">version
dependency</span></a>), or didn’t get them to work for C++.</p></li>
</ul>
<p>Prebuilt toolchains may work for C, but I failed to find one that
works for C++. The amount of work that I invested in finding one was,
in my opinion, totally wasted. Building a toolchain yourself is not at
all hard, provided that you bring basic Linux understanding (which you
should if you program for it).</p>
<p>In my opinion (please given me <a class="reference internal" href="../../../about/myself/index.html"><span class="doc">feedback</span></a>), this article describes the most
close-to-correct way to build a toolchain for a target that does not
come with a toolchain. Although I describe the situation for the
Raspberry (because that was my primary intention), it will sure work
for <em>any</em> target.</p>
</section>
<section id="installing-crosstool-ng">
<h2><a class="toc-backref" href="#id14" role="doc-backlink">Installing <code class="docutils literal notranslate"><span class="pre">crosstool-ng</span></code></a><a class="headerlink" href="#installing-crosstool-ng" title="Link to this heading">¶</a></h2>
<p>Below is a writeup of how I installed <code class="docutils literal notranslate"><span class="pre">crosstool-ng</span></code> (running
Fedora, I chose to install from a released tarball) . Please read
through their <a class="reference external" href="https://crosstool-ng.github.io/docs/install/">installation documentation</a> for your particular
situation.</p>
<section id="prerequisites">
<h3><a class="toc-backref" href="#id15" role="doc-backlink">Prerequisites</a><a class="headerlink" href="#prerequisites" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">crosstool-ng</span></code> requires one to install a number of packages
first. Thankfully, they do thorough testing in Docker, and the list of
dependencies can be taken from the Docker file for your OS (see <a class="reference external" href="https://github.com/crosstool-ng/crosstool-ng/tree/master/testing/docker">here</a>).</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">Dependencies for Fedora</span><a class="headerlink" href="#id7" title="Link to this code">¶</a></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">root@host # </span>dnf<span class="w"> </span>install<span class="w"> </span>autoconf<span class="w"> </span>gperf<span class="w"> </span>bison<span class="w"> </span>file<span class="w"> </span>flex<span class="w"> </span>texinfo<span class="w"> </span>help2man<span class="w"> </span>gcc-c++<span class="w"> </span>libtool<span class="w"> </span>make<span class="w"> </span>patch<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>ncurses-devel<span class="w"> </span>python3-devel<span class="w"> </span>perl-Thread-Queue<span class="w"> </span>bzip2<span class="w"> </span>git<span class="w"> </span>wget<span class="w"> </span>which<span class="w"> </span>xz<span class="w"> </span>unzip<span class="w"> </span>rsync<span class="w"> </span>diffutils<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>meson<span class="w"> </span>ninja-build
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">Dependencies for Ubuntu</span><a class="headerlink" href="#id8" title="Link to this code">¶</a></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">root@host # </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>gcc<span class="w"> </span>g++<span class="w"> </span>gperf<span class="w"> </span>bison<span class="w"> </span>flex<span class="w"> </span>texinfo<span class="w"> </span>help2man<span class="w"> </span>make<span class="w"> </span>libncurses5-dev<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>python3-dev<span class="w"> </span>autoconf<span class="w"> </span>automake<span class="w"> </span>libtool<span class="w"> </span>libtool-bin<span class="w"> </span>gawk<span class="w"> </span>wget<span class="w"> </span>bzip2<span class="w"> </span>xz-utils<span class="w"> </span>unzip<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>patch<span class="w"> </span>libstdc++6<span class="w"> </span>rsync<span class="w"> </span>git<span class="w"> </span>meson<span class="w"> </span>ninja-build
</pre></div>
</div>
</div>
</section>
<section id="installing-from-cloned-git-repository">
<h3><a class="toc-backref" href="#id16" role="doc-backlink">Installing From Cloned Git Repository</a><a class="headerlink" href="#installing-from-cloned-git-repository" title="Link to this heading">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>At one point, <code class="docutils literal notranslate"><span class="pre">ct-ng</span></code> (as installed from the release tarball)
failed to build toolchains because it tried to download a version
of <code class="docutils literal notranslate"><span class="pre">zlib</span></code> that did not exist anymore:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">[EXTRA]    Retrieving &#39;zlib-1.2.12&#39;</span>
<span class="go">[ERROR]    zlib: download failed</span>
</pre></div>
</div>
<p>The issue had already been resolved in the upstream repository, but
no tarball release had been made. So building <code class="docutils literal notranslate"><span class="pre">crosstool-ng</span></code> from
source is in order.</p>
</div>
<p>The steps are basically the same as installing from the release
tarball, except that some massaging (yes, autotools) in the source
directory is necessary prior to building.</p>
<p>Clone repository, and massage source tree:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">me@host$ </span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/crosstool-ng/crosstool-ng
<span class="gp">me@host$ </span><span class="nb">cd</span><span class="w"> </span>crosstool-ng/
<span class="gp">me@host$ </span>sh<span class="w"> </span>./bootstrap
<span class="gp">me@host$ </span>./configure<span class="w"> </span>--prefix<span class="o">=</span>/home/jfasch/cross
<span class="gp">me@host$ </span>make
<span class="gp">me@host$ </span>make<span class="w"> </span>install
</pre></div>
</div>
</section>
<section id="installing-from-release-tarball">
<h3><a class="toc-backref" href="#id17" role="doc-backlink">Installing From Release Tarball</a><a class="headerlink" href="#installing-from-release-tarball" title="Link to this heading">¶</a></h3>
<p>As complained above, releases might be out of date. Anyway, the
procedure is slightly simpler that building from the upstream repo
source. Download latest release <a class="reference external" href="https://crosstool-ng.github.io/download/">here</a>); current version as of
this writing is <code class="docutils literal notranslate"><span class="pre">1.25.0</span></code>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">me@host$ </span>wget<span class="w"> </span>http://crosstool-ng.org/download/crosstool-ng/crosstool-ng-1.25.0.tar.xz
<span class="gp">me@host$ </span>tar<span class="w"> </span>xf<span class="w"> </span>crosstool-ng-1.25.0.tar.xz
<span class="gp">me@host$ </span><span class="nb">cd</span><span class="w"> </span>crosstool-ng-1.25.0/
<span class="gp">me@host$ </span>./configure<span class="w"> </span>--prefix<span class="o">=</span>/home/jfasch/cross
<span class="gp">me@host$ </span>make
<span class="gp">me@host$ </span>make<span class="w"> </span>install
</pre></div>
</div>
</section>
<section id="path-and-basic-test">
<h3><a class="toc-backref" href="#id18" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">PATH</span></code>, And Basic Test</a><a class="headerlink" href="#path-and-basic-test" title="Link to this heading">¶</a></h3>
<p>Add <code class="docutils literal notranslate"><span class="pre">ct-ng</span></code> to <code class="docutils literal notranslate"><span class="pre">PATH</span></code>,</p>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text">You may want to add this to <code class="docutils literal notranslate"><span class="pre">~/.bashrc</span></code></span><a class="headerlink" href="#id9" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>me@host$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$HOME</span>/cross/bin:<span class="nv">$PATH</span>
</pre></div>
</div>
</div>
<p>Test if all is well,</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">me@host$ </span>ct-ng<span class="w"> </span><span class="nb">help</span>
<span class="go">This is crosstool-NG version 1.25.0</span>

<span class="go">Copyright (C) 2008  Yann E. MORIN &lt;yann.morin.1998@free.fr&gt;</span>
<span class="go">This is free software; see the source for copying conditions.</span>
<span class="go">There is NO warranty; not even for MERCHANTABILITY or FITNESS FOR A</span>
<span class="go">PARTICULAR PURPOSE.</span>
<span class="go">...</span>
</pre></div>
</div>
</section>
</section>
<section id="configure-toolchain-build">
<h2><a class="toc-backref" href="#id19" role="doc-backlink">Configure Toolchain Build</a><a class="headerlink" href="#configure-toolchain-build" title="Link to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">ct-ng</span></code> toolchain build configuration works a lot like the Linux
kernel’s configuration system (a little less elaborate though). There
are a number of base configurations to choose from (we need a
Raspberry config), and, having chosen one, you can tune it to your
needs.</p>
<section id="base-configuration-for-the-raspberry">
<h3><a class="toc-backref" href="#id20" role="doc-backlink">Base Configuration For The Raspberry</a><a class="headerlink" href="#base-configuration-for-the-raspberry" title="Link to this heading">¶</a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">me@host$ </span>ct-ng<span class="w"> </span>list-samples<span class="p">|</span>grep<span class="w"> </span>rpi
<span class="go">[G...]   aarch64-rpi3-linux-gnu</span>
<span class="go">[G...]   aarch64-rpi4-linux-gnu</span>
<span class="go">[G...]   armv7-rpi2-linux-gnueabihf</span>
<span class="go">[G...]   armv8-rpi3-linux-gnueabihf</span>
<span class="go">[G...]   armv8-rpi4-linux-gnueabihf</span>
</pre></div>
</div>
<p>Mine is a Pi 4, still running the (still default) 32 bit version, so I
create a <code class="docutils literal notranslate"><span class="pre">.config</span></code> file for that,</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">me@host $ </span>ct-ng<span class="w"> </span>armv8-rpi4-linux-gnueabihf
<span class="gp">me@host $ </span>ls<span class="w"> </span>-l<span class="w"> </span>.config
<span class="go">-rw-r--r--. 1 jfasch jfasch 23179 Sep 23 08:18 .config</span>
</pre></div>
</div>
</section>
<section id="important-glibc-version">
<span id="glibc-version"></span><h3><a class="toc-backref" href="#id21" role="doc-backlink">Important: <code class="docutils literal notranslate"><span class="pre">glibc</span></code> Version</a><a class="headerlink" href="#important-glibc-version" title="Link to this heading">¶</a></h3>
<section id="the-error">
<h4><a class="toc-backref" href="#id22" role="doc-backlink">The Error</a><a class="headerlink" href="#the-error" title="Link to this heading">¶</a></h4>
<p>Executables built by your toolchain won’t work if the toolchain links
against a C library whose version is higher than what is present on
the target. Continuing with the above default configuration, and just
saying <code class="docutils literal notranslate"><span class="pre">ct-ng</span> <span class="pre">build</span></code> will likely result in an error
<a class="footnote-reference brackets" href="#glibc-default-version" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a>.</p>
<p>A minimal <code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">main()</span> <span class="pre">{</span> <span class="pre">return</span> <span class="pre">0;</span> <span class="pre">}</span></code> program, compiled for the
target, will complain:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">me@target $ </span>./a.out
<span class="go">./a.out: /lib/arm-linux-gnueabihf/libc.so.6: version `GLIBC_2.34&#39; not found (required by ./a.out)</span>
</pre></div>
</div>
<p>Background is that <code class="docutils literal notranslate"><span class="pre">glibc</span></code> employs <a class="reference external" href="https://refspecs.linuxfoundation.org/LSB_3.0.0/LSB-PDA/LSB-PDA.junk/symversion.html">ELF symbol versioning</a>
a lot. Key point is that an executable which links against version,
say, <cite>2.34</cite> (which is the <code class="docutils literal notranslate"><span class="pre">ct-ng</span></code> default), will require the symbol
<code class="docutils literal notranslate"><span class="pre">GLIBC_2.34</span></code> in the C library, and fail to load if the target
<code class="docutils literal notranslate"><span class="pre">glibc</span></code> version is, say, <code class="docutils literal notranslate"><span class="pre">2.28</span></code> <a class="footnote-reference brackets" href="#my-situation" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>. That version
obviously cannot have <code class="docutils literal notranslate"><span class="pre">GLIBC_2.34</span></code>, so the executable cannot load.</p>
<p>Find out location of <code class="docutils literal notranslate"><span class="pre">glibc</span></code>,</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">me@target $ </span>ldd<span class="w"> </span>/usr/bin/ls
<span class="go">        ...</span>
<span class="go">        libc.so.6 =&gt; /lib/arm-linux-gnueabihf/libc.so.6 (0xb6e06000)</span>
<span class="go">        ...</span>
</pre></div>
</div>
<p>Simply <em>invoke</em> (sic!) the library,</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">me@target $ </span>/lib/arm-linux-gnueabihf/libc.so.6
<span class="go">GNU C Library (Debian GLIBC 2.28-10+rpt2+rpi1+deb10u1) stable release version 2.28.</span>
<span class="go">...</span>
</pre></div>
</div>
</section>
<section id="the-fix">
<h4><a class="toc-backref" href="#id23" role="doc-backlink">The Fix</a><a class="headerlink" href="#the-fix" title="Link to this heading">¶</a></h4>
<p>So, it’s <code class="docutils literal notranslate"><span class="pre">2.28</span></code>. Back on the <em>host</em> again, tune configuration:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">me@host $ </span>ct-ng<span class="w"> </span>menuconfig
</pre></div>
</div>
<p>In <code class="docutils literal notranslate"><span class="pre">C-library</span> <span class="pre">-&gt;</span> <span class="pre">Version</span> <span class="pre">of</span> <span class="pre">glibc</span></code>, choose <code class="docutils literal notranslate"><span class="pre">2.28</span></code>.</p>
<a class="reference internal image-reference" href="../../../_images/glibc-version.png"><img alt="../../../_images/glibc-version.png" src="../../../_images/glibc-version.png" style="width: 477.0px; height: 255.5px;" /></a>
<p>Minor quirk: version <code class="docutils literal notranslate"><span class="pre">2.28</span></code> does not build without warnings, so one
has to disable <code class="docutils literal notranslate"><span class="pre">-Werror</span></code> during its build,</p>
<a class="reference internal image-reference" href="../../../_images/werror.png"><img alt="../../../_images/werror.png" src="../../../_images/werror.png" style="width: 477.0px; height: 255.5px;" /></a>
</section>
</section>
<section id="important-gcc-version">
<h3><a class="toc-backref" href="#id24" role="doc-backlink">Important: GCC Version</a><a class="headerlink" href="#important-gcc-version" title="Link to this heading">¶</a></h3>
<p>Not only is the Pi’s <code class="docutils literal notranslate"><span class="pre">glibc</span></code> version rather outdated; GCC is also a
bit behind - it’s <code class="docutils literal notranslate"><span class="pre">8.3.0</span></code>.</p>
<section id="id4">
<h4><a class="toc-backref" href="#id25" role="doc-backlink">The Error</a><a class="headerlink" href="#id4" title="Link to this heading">¶</a></h4>
<p>Using the latest supported GCC version (<code class="docutils literal notranslate"><span class="pre">12.2.0</span></code> as of this writing)
as a cross compiler, A less trivial C++ program fails to start:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">./a.out: /lib/arm-linux-gnueabihf/libstdc++.so.6: version `GLIBCXX_3.4.29&#39; not found (required by ./a.out)</span>
<span class="go">./a.out: /lib/arm-linux-gnueabihf/libstdc++.so.6: version `GLIBCXX_3.4.26&#39; not found (required by ./a.out)</span>
</pre></div>
</div>
<p>It turns out that the program makes use of the <code class="docutils literal notranslate"><span class="pre">std::filesystem</span></code>
library that has been added in C++17. Apparently that library uses
some more modern functionality from GCC’s C++ support library,
<code class="docutils literal notranslate"><span class="pre">libgcc_s.so.1</span></code>. That functionality is obviously not contained in
<code class="docutils literal notranslate"><span class="pre">libgcc_s.so.1</span></code> as of GCC <code class="docutils literal notranslate"><span class="pre">8.3.0</span></code></p>
</section>
<section id="id5">
<h4><a class="toc-backref" href="#id26" role="doc-backlink">The Fix</a><a class="headerlink" href="#id5" title="Link to this heading">¶</a></h4>
<p>Downgrade the toolchain’s GCC to something like <code class="docutils literal notranslate"><span class="pre">8.3.0</span></code> (<code class="docutils literal notranslate"><span class="pre">8.5.0</span></code>
is just a minor release, so it should work).</p>
<p>In <code class="docutils literal notranslate"><span class="pre">C</span> <span class="pre">compiler</span> <span class="pre">-&gt;</span> <span class="pre">Version</span> <span class="pre">of</span> <span class="pre">gcc</span></code>, choose <code class="docutils literal notranslate"><span class="pre">8.5.0</span></code>:</p>
<a class="reference internal image-reference" href="../../../_images/gcc-version.png"><img alt="../../../_images/gcc-version.png" src="../../../_images/gcc-version.png" style="width: 400.5px; height: 264.5px;" /></a>
</section>
</section>
</section>
<section id="toolchain-build-install">
<h2><a class="toc-backref" href="#id27" role="doc-backlink">Toolchain Build/Install</a><a class="headerlink" href="#toolchain-build-install" title="Link to this heading">¶</a></h2>
<p>This is as simple as saying,</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">me@host $ </span>ct-ng<span class="w"> </span>build
</pre></div>
</div>
<p>By default <a class="footnote-reference brackets" href="#ct-prefix" id="id6" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>, the toolchain is installed in
<code class="docutils literal notranslate"><span class="pre">$HOME/x-tools/armv8-rpi4-linux-gnueabihf/</span></code> (you may want to add
<code class="docutils literal notranslate"><span class="pre">$HOME/x-tools/armv8-rpi4-linux-gnueabihf/bin/</span></code> to <code class="docutils literal notranslate"><span class="pre">$PATH</span></code>).</p>
<p>For build system configuration (see for example
<a class="reference internal" href="../../../trainings/material/soup/linux/toolchain/cmake/cross.html"><span class="doc">CMake: Cross Build</span></a>),</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">PATH</span></code> (best in <code class="docutils literal notranslate"><span class="pre">~/.bashrc</span></code>)</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">$HOME/x-tools/armv8-rpi4-linux-gnueabihf/bin</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Sysroot; in CMake toolchain files (see
<a class="reference internal" href="../../../trainings/material/soup/linux/toolchain/cmake/cross.html"><span class="doc">CMake: Cross Build</span></a>,
“Toolchain Files”), this is</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CMAKE_FIND_ROOT_PATH</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CMAKE_SYSROOT</span></code></p></li>
</ul>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">$HOME/x-tools/armv8-rpi4-linux-gnueabihf/armv8-rpi4-linux-gnueabihf</span></code></p></td>
</tr>
</tbody>
</table>
</section>
<section id="test">
<h2><a class="toc-backref" href="#id28" role="doc-backlink">Test</a><a class="headerlink" href="#test" title="Link to this heading">¶</a></h2>
<p>I tested the toolchain from a number of viewpoints that I describe
below.</p>
<section id="simplest-c-stdio-h">
<h3><a class="toc-backref" href="#id29" role="doc-backlink">Simplest: C, <code class="docutils literal notranslate"><span class="pre">&lt;stdio.h&gt;</span></code></a><a class="headerlink" href="#simplest-c-stdio-h" title="Link to this heading">¶</a></h3>
<p>Check for availability of <code class="docutils literal notranslate"><span class="pre">libc</span></code>.</p>
<div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-text"><a class="reference download internal" download="" href="../../../_downloads/930da294b589e3c0ee18e29e9212dc93/c-stdio.c"><code class="xref download docutils literal notranslate"><span class="pre">c-stdio.c</span></code></a></span><a class="headerlink" href="#id10" title="Link to this code">¶</a></div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Hello World</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">me@host $ </span>~/x-tools/armv8-rpi4-linux-gnueabihf/bin/armv8-rpi4-linux-gnueabihf-gcc<span class="w"> </span>c-stdio.c
<span class="gp">me@host $ </span>scp<span class="w"> </span>a.out<span class="w"> </span>me@target:
<span class="gp">me@host $ </span>ssh<span class="w"> </span>me@target<span class="w"> </span>./a.out
<span class="go">Hello World</span>
</pre></div>
</div>
</section>
<section id="c-iostream">
<h3><a class="toc-backref" href="#id30" role="doc-backlink">C++, <code class="docutils literal notranslate"><span class="pre">&lt;iostream&gt;</span></code></a><a class="headerlink" href="#c-iostream" title="Link to this heading">¶</a></h3>
<p>Check for availability of <code class="docutils literal notranslate"><span class="pre">libstdc++</span></code>.</p>
<div class="literal-block-wrapper docutils container" id="id11">
<div class="code-block-caption"><span class="caption-text"><a class="reference download internal" download="" href="../../../_downloads/1f44756998952fcb268db788f7cf730b/c%2B%2B-iostream.cpp"><code class="xref download docutils literal notranslate"><span class="pre">c++-iostream.cpp</span></code></a></span><a class="headerlink" href="#id11" title="Link to this code">¶</a></div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Hello World&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">me@host $ </span>~/x-tools/armv8-rpi4-linux-gnueabihf/bin/armv8-rpi4-linux-gnueabihf-g++<span class="w"> </span>c++-iostream.cpp
<span class="gp">me@host $ </span>scp<span class="w"> </span>a.out<span class="w"> </span>me@target:
<span class="gp">me@host $ </span>ssh<span class="w"> </span>me@target<span class="w"> </span>./a.out
<span class="go">Hello World</span>
</pre></div>
</div>
</section>
<section id="c-thread">
<h3><a class="toc-backref" href="#id31" role="doc-backlink">C++, <code class="docutils literal notranslate"><span class="pre">&lt;thread&gt;</span></code></a><a class="headerlink" href="#c-thread" title="Link to this heading">¶</a></h3>
<p>Check for availability of <code class="docutils literal notranslate"><span class="pre">libpthread</span></code>.</p>
<div class="literal-block-wrapper docutils container" id="id12">
<div class="code-block-caption"><span class="caption-text"><a class="reference download internal" download="" href="../../../_downloads/59cbba0b5d6de2183a7a48be92ed635e/c%2B%2B-thread.cpp"><code class="xref download docutils literal notranslate"><span class="pre">c++-thread.cpp</span></code></a></span><a class="headerlink" href="#id12" title="Link to this code">¶</a></div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;thread&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="w"> </span><span class="n">t</span><span class="p">([](){</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Hello Thread&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">    </span><span class="n">t</span><span class="p">.</span><span class="n">join</span><span class="p">();</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Bye&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">me@host $ </span>~/x-tools/armv8-rpi4-linux-gnueabihf/bin/armv8-rpi4-linux-gnueabihf-g++<span class="w"> </span>-pthread<span class="w"> </span>c++-thread.cpp
<span class="gp">me@host $ </span>scp<span class="w"> </span>a.out<span class="w"> </span>me@target:
<span class="gp">me@host $ </span>ssh<span class="w"> </span>me@target<span class="w"> </span>./a.out
<span class="go">Hello Thread</span>
<span class="go">Bye</span>
</pre></div>
</div>
</section>
</section>
<section id="packaging-distributing-the-toolchain">
<h2><a class="toc-backref" href="#id32" role="doc-backlink">Packaging/Distributing The Toolchain</a><a class="headerlink" href="#packaging-distributing-the-toolchain" title="Link to this heading">¶</a></h2>
<p>The toolchain is fully relocatable. Although
<code class="docutils literal notranslate"><span class="pre">$HOME/x-tools/armv8-rpi4-linux-gnueabihf/</span></code> contains the cross
toolchain <em>together</em> with the <a class="reference internal" href="../../../trainings/material/soup/linux/toolchain/cross/basics.html"><span class="doc">sysroot</span></a>, even if you
move it around it will remain self-contained.</p>
<p>Pack it into an archive,</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>tar<span class="w"> </span>-C<span class="w"> </span>~/x-tools<span class="w"> </span>-J<span class="w"> </span>-c<span class="w"> </span>-f<span class="w"> </span>raspberry-pi-toolchain.tar.xz<span class="w"> </span>armv8-rpi4-linux-gnueabihf/
</pre></div>
</div>
<p>And share it with your colleagues.</p>
</section>
<section id="afterword">
<h2><a class="toc-backref" href="#id33" role="doc-backlink">Afterword</a><a class="headerlink" href="#afterword" title="Link to this heading">¶</a></h2>
<p>I hope I could help you with this article. Share it if I could, or, if
I couldn’t, feel free to send me an <a class="reference internal" href="../../../about/myself/index.html"><span class="doc">email</span></a> explaining why.</p>
<p>Either way: cross development is not easy, given the huge number of
dependencies between target libraries. This is a rather complex and
fragile thing, and there are sure better ways to do cross development
than the one that I describe here. Ideally, a target vendor (in our
case, the guys who create <a class="reference external" href="https://www.raspberrypi.com/software/">Raspberry Pi OS</a>) would release an SDK that
developers could install, and that contained <em>all</em> that is necessary
to do cross development. This would be the toolchain and associated
basic runtime libraries (described here), and the entire <em>sysroot</em> of
the target.</p>
<p>Creating such an SDK is the job of higher level tools like <a class="reference external" href="https://www.yoctoproject.org/">Yocto</a> or <a class="reference external" href="https://buildroot.org/">Buildroot</a> - but this is another story.</p>
<p class="rubric">Footnotes</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="my-situation" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">1</a><span class="fn-bracket">]</span></span>
<p>That describes the situation that I encountered;
yours might be a little different.</p>
</aside>
<aside class="footnote brackets" id="ct-prefix" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id6">2</a><span class="fn-bracket">]</span></span>
<p>You change the installation prefix by setting the
<code class="docutils literal notranslate"><span class="pre">CT_PREFIX</span></code> environment variable prior to building,</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nv">CT_PREFIX</span><span class="o">=</span>/some/other/location<span class="w"> </span>ct-ng<span class="w"> </span>build
</pre></div>
</div>
</aside>
<aside class="footnote brackets" id="glibc-default-version" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">3</a><span class="fn-bracket">]</span></span>
<p>As of this writing, <code class="docutils literal notranslate"><span class="pre">ct-ng</span></code> chooses the
GNU C Library version <code class="docutils literal notranslate"><span class="pre">2.34</span></code>. Your
situation might be different, the
principle remains the same.</p>
</aside>
</aside>
</section>
</section>

<div class="section ablog__blog_comments">
  
  


<div class="section ablog__prev-next">
  <span class="ablog__prev">
    
    
    <a href="../../2021/09/xps13-shim-mok-brick/index.html">
      
      <i class="fa fa-arrow-circle-left"></i>
      
      <span>How to Brick a €1399 Dell XPS 13</span>
    </a>
    
  </span>
  <span class="ablog__spacer">&nbsp;</span>
  <span class="ablog__next">
    
  </span>
</div>

  
  
</div>

          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &#169;2019-2024 (GPLv3), Jörg Faschingbauer.
      
      |
      <a href="../../../_sources/blog/2022/09/cross-raspi.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>