
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"><meta content="Using a Raspberry Pi and PCA9685 PWM controller to operate a brushless motor" name="description" />
<meta content="linux, raspberry, raspberry pi, pwm, brushless, drone, car, rc, electronic speed controller, esc" name="keywords" />

    <title>Controlling a Brushless Motor With Raspberry Pi &#8212; Jörg Faschingbauer</title>
    <link rel="stylesheet" href="../../../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/css/jf-alabaster.css" />
    <script id="documentation_options" data-url_root="../../../../../" src="../../../../../_static/documentation_options.js"></script>
    <script src="../../../../../_static/jquery.js"></script>
    <script src="../../../../../_static/underscore.js"></script>
    <script src="../../../../../_static/doctools.js"></script>
    <script src="../../../../../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="canonical" href="https://www.faschingbauer.co.at/about/site/opentraining/misc/draft-topics/brushless-motor.html" />
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
    <link rel="next" title="Work in Progress" href="../../../work-in-progress/index.html" />
    <link rel="prev" title="Userspace PWM" href="pwm.html" />
  
   
  <link rel="stylesheet" href="../../../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  
  <link rel="alternate" type="application/atom+xml"  href="../../../../../blog/atom.xml" title="Jörg Faschingbauer">
  
  
  <link href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css" rel="stylesheet">
  
  <style type="text/css">
    ul.ablog-archive {list-style: none; overflow: auto; margin-left: 0px}
    ul.ablog-archive li {float: left; margin-right: 5px; font-size: 80%}
    ul.postlist a {font-style: italic;}
    ul.postlist-style-disc {list-style-type: disc;}
    ul.postlist-style-none {list-style-type: none;}
    ul.postlist-style-circle {list-style-type: circle;}
  </style>

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../../../../../index.html">
    <img class="logo" src="../../../../../_static/logo.png" alt="Logo"/>
    
  </a>
</p>



<p class="blurb">Linux und Open Source</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script><h3>Navigation</h3>
<p class="caption"><span class="caption-text">Schulungen</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../trainings/index.html">Kursangebot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../trainings/material/index.html">Unterlagen &amp; Download</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../trainings/org.html">Organisatorisches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../trainings/codex.html">Datenschutz</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../trainings/log/index.html">Bisher Gehaltene</a></li>
</ul>
<p class="caption"><span class="caption-text">About</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../myself/index.html">Über Mich</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../index.html">This Site</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html">OpenTraining</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../usecases/index.html">Use Cases</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../plan/plan.html">Project Plan</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../netidee/index.html">Netidee Förderantrag</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../index.html">Miscellaneous</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../s5/index.html">S5 Integration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../screencast.html">Screencasts</a></li>
<li class="toctree-l4"><a class="reference internal" href="../topics-to-write.html">Topics to be Written</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="index.html">Draft Topics</a><ul class="current">
<li class="toctree-l5"><a class="reference internal" href="hardware-group.html">Hardware</a></li>
<li class="toctree-l5"><a class="reference internal" href="pwm.html">Userspace PWM</a></li>
<li class="toctree-l5 current"><a class="current reference internal" href="#">Controlling a Brushless Motor With Raspberry Pi</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../work-in-progress/index.html">Work in Progress</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../recipes.html">Recipes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../layout-test.html">Layout Test Page</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../mathml.html"><code class="docutils literal notranslate"><span class="pre">mmlalias.txt</span></code>: MathML aliases for entities from other sets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../isoamsa.html"><code class="docutils literal notranslate"><span class="pre">isoamsa.txt</span></code>: Added Mathematical Symbols: Arrows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../isoamsr.html"><code class="docutils literal notranslate"><span class="pre">isoamsr.txt</span></code>: Added Mathematical Symbols: Relations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../isonum.html"><code class="docutils literal notranslate"><span class="pre">isonum.txt</span></code>: Added Mathematical Symbols: Binary Operators</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Blog</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../blog/index.html">Posts</a></li>
</ul>


        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <svg width="424pt" height="212pt"
 viewBox="0.00 0.00 424.00 212.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 208)">
<polygon fill="white" stroke="transparent" points="-4,4 -4,-208 420,-208 420,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_draft</title>
<path fill="none" stroke="black" d="M20,-8C20,-8 396,-8 396,-8 402,-8 408,-14 408,-20 408,-20 408,-184 408,-184 408,-190 402,-196 396,-196 396,-196 20,-196 20,-196 14,-196 8,-190 8,-184 8,-184 8,-20 8,-20 8,-14 14,-8 20,-8"/>
<text text-anchor="middle" x="208" y="-180.8" font-family="Times,serif" font-size="14.00">Draft Topics</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_draft_hardware</title>
<path fill="none" stroke="black" d="M28,-16C28,-16 388,-16 388,-16 394,-16 400,-22 400,-28 400,-28 400,-153 400,-153 400,-159 394,-165 388,-165 388,-165 28,-165 28,-165 22,-165 16,-159 16,-153 16,-153 16,-28 16,-28 16,-22 22,-16 28,-16"/>
<text text-anchor="middle" x="208" y="-149.8" font-family="Times,serif" font-size="14.00">Hardware</text>
</g>
<!-- draft_hardware_brushless_motor -->
<g id="node1" class="node">
<title>draft_hardware_brushless_motor</title>
<path fill="#dcdcdc" stroke="black" stroke-width="3" d="M36,-97.5C36,-97.5 380,-97.5 380,-97.5 386,-97.5 392,-103.5 392,-109.5 392,-109.5 392,-121.5 392,-121.5 392,-127.5 386,-133.5 380,-133.5 380,-133.5 36,-133.5 36,-133.5 30,-133.5 24,-127.5 24,-121.5 24,-121.5 24,-109.5 24,-109.5 24,-103.5 30,-97.5 36,-97.5"/>
<text text-anchor="middle" x="208" y="-111.8" font-family="Times,serif" font-size="14.00">Controlling a Brushless Motor With Raspberry Pi</text>
</g>
<!-- draft_hardware_pwm -->
<g id="node2" class="node">
<title>draft_hardware_pwm</title>
<g id="a_node2"><a xlink:href="pwm.html" xlink:title="Userspace PWM">
<path fill="#dcdcdc" stroke="black" d="M153,-24.5C153,-24.5 263,-24.5 263,-24.5 269,-24.5 275,-30.5 275,-36.5 275,-36.5 275,-48.5 275,-48.5 275,-54.5 269,-60.5 263,-60.5 263,-60.5 153,-60.5 153,-60.5 147,-60.5 141,-54.5 141,-48.5 141,-48.5 141,-36.5 141,-36.5 141,-30.5 147,-24.5 153,-24.5"/>
<text text-anchor="middle" x="208" y="-38.8" font-family="Times,serif" font-size="14.00">Userspace PWM</text>
</a>
</g>
</g>
<!-- draft_hardware_brushless_motor&#45;&gt;draft_hardware_pwm -->
<g id="edge1" class="edge">
<title>draft_hardware_brushless_motor&#45;&gt;draft_hardware_pwm</title>
<path fill="none" stroke="black" d="M208,-97.31C208,-89.29 208,-79.55 208,-70.57"/>
<polygon fill="black" stroke="black" points="211.5,-70.53 208,-60.53 204.5,-70.53 211.5,-70.53"/>
</g>
</g>
</svg>
<div class="section" id="controlling-a-brushless-motor-with-raspberry-pi">
<h1>Controlling a Brushless Motor With Raspberry Pi<a class="headerlink" href="#controlling-a-brushless-motor-with-raspberry-pi" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#setup" id="id1">Setup</a></p></li>
<li><p><a class="reference internal" href="#electronic-speed-controller-esc" id="id2">Electronic Speed Controller (ESC)</a></p></li>
<li><p><a class="reference internal" href="#why-an-external-pwm-controller" id="id3">Why An External PWM Controller?</a></p></li>
<li><p><a class="reference internal" href="#draft-material" id="id4">Draft Material</a></p>
<ul>
<li><p><a class="reference internal" href="#information-sources" id="id5">Information Sources</a></p></li>
<li><p><a class="reference internal" href="#motor-controller" id="id6">Motor Controller</a></p></li>
<li><p><a class="reference internal" href="#links" id="id7">Links</a></p></li>
</ul>
</li>
</ul>
</div>
<p>There is quite a bit of information out there on the Internet about
how to talk to an <em>Electronic Speed Controller</em> (ESC - the thing that
actually controls the motor). Those pages explain the topic in the
context of microcontroller programming, or even in the context of a
ready-made flight/drone firmware that is put onto Arduinos.</p>
<p>The focus of this topic is to control a brushless motor from an
automation point of view. Imagine an autonomous vehicle that grabs
boxes from a storage rack. It has several motors, and a small computer
(a Raspberry Pi for example) that controls the motors based on what it
is told over, say, an internet connection. The vehicle might also do
image recognition, which is why choosing something more powerful than
an Arduino might be a good idea.</p>
<div class="section" id="setup">
<h2><a class="toc-backref" href="#id1">Setup</a><a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h2>
<p>jjj fritzing rpi + pca + esc + motor</p>
</div>
<div class="section" id="electronic-speed-controller-esc">
<h2><a class="toc-backref" href="#id2">Electronic Speed Controller (ESC)</a><a class="headerlink" href="#electronic-speed-controller-esc" title="Permalink to this headline">¶</a></h2>
<p>Watch the video below to learn how brushless motors work, and what the
job of an ESC is. That video also explains briefly what Pulse Width
Modulation (PWM) is; see <a class="reference internal" href="pwm.html"><span class="doc">here</span></a> for more.</p>
<iframe width="560"
        height="315"
        src="https://www.youtube.com/embed/uOQk8SJso6Q"
        frameborder="0"
        allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
        allowfullscreen>
</iframe><p>This topic is about speed controllers that use PWM as “command
protocol”. While using PWM as a protocol sounds like a poor
architectural decision - to say the least - such controllers are the
most common, and I believe they are also cheapest, which is why one
such - <a class="reference external" href="https://www.hobbywing.com/goods.php?id=356">Quicrun 16BL30</a>
(<a class="reference download internal" download="" href="../../../../../_downloads/2b33f1a343d19c6c528fb7f32355af07/QuicRunWP10BL30-10BL60-8BL150.pdf"><code class="xref download docutils literal notranslate"><span class="pre">Datasheet</span></code></a>) - was
chosen for this little prototype project.</p>
</div>
<div class="section" id="why-an-external-pwm-controller">
<h2><a class="toc-backref" href="#id3">Why An External PWM Controller?</a><a class="headerlink" href="#why-an-external-pwm-controller" title="Permalink to this headline">¶</a></h2>
<p>While it is possible to drive a PWM signal on a GPIO pin from software
that runs on the CPU, this is not generally a good idea. This is
especially true for mission critical applications such as motor
control, where harm could be done to people and/or money.</p>
<p>Linux is much more complex than any bare-metal OS that is usually used
for such applications. It has a network stack that operates in the
background, and a filesystem and block IO layer, and maybe a graphics
stack, other software such as remote login programs, a webserver, and
much more.</p>
<p>Driving a PWM signal at a millisecond frequency would mean that the
PWM software would have to compete with a possibly unknown number of
other processes in the system - leading to glitches and hard-to-detect
errors. While Linux, as deployed on the Raspberry, has real-time
capabilities that try to give wakeup guarantees, this is a best-effort
approach. Turning Linux into a realtime OS that gives hard guarantees
<a class="reference external" href="https://rt.wiki.kernel.org/index.php/Main_Page">is no fun</a>.</p>
<p>Attaching a PCA9685 PWM controller is really simple, and to use it
from Linux is even simpler, so this approach was chosen.</p>
</div>
<div class="section" id="draft-material">
<h2><a class="toc-backref" href="#id4">Draft Material</a><a class="headerlink" href="#draft-material" title="Permalink to this headline">¶</a></h2>
<div class="section" id="information-sources">
<h3><a class="toc-backref" href="#id5">Information Sources</a><a class="headerlink" href="#information-sources" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>PCA9685 (PWM controller)</p>
<ul>
<li><p>In motor driver context; using wiringPi:
<a class="reference external" href="https://www.raspberry-pi-geek.de/ausgaben/rpg/2016/06/i-2-c-workshop-teil-11-pwm-modul-pca9685/">https://www.raspberry-pi-geek.de/ausgaben/rpg/2016/06/i-2-c-workshop-teil-11-pwm-modul-pca9685/</a></p></li>
<li><p>Datasheet <a class="reference external" href="https://www.nxp.com/docs/en/data-sheet/PCA9685.pdf">https://www.nxp.com/docs/en/data-sheet/PCA9685.pdf</a></p></li>
</ul>
</li>
<li><p>Quicrun 16BL30</p>
<ul>
<li><p><a class="reference external" href="https://www.hobbywing.com/goods.php?id=356">https://www.hobbywing.com/goods.php?id=356</a></p></li>
<li><p>“Datasheet”:
<a class="reference external" href="https://www.hobbywing.com/products/enpdf/QuicRunWP10BL30-10BL60-8BL150.pdf">https://www.hobbywing.com/products/enpdf/QuicRunWP10BL30-10BL60-8BL150.pdf</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="motor-controller">
<h3><a class="toc-backref" href="#id6">Motor Controller</a><a class="headerlink" href="#motor-controller" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>How Brushless Motor and ESC Work and How To Control them using
Arduino: <a class="reference external" href="https://www.youtube.com/watch?v=uOQk8SJso6Q">https://www.youtube.com/watch?v=uOQk8SJso6Q</a></p>
<ul class="simple">
<li><p>Arming: at the time of powering the ESC, the signal (duty cycle I
believe) must be &lt;= 1ms. Confirmation beep.</p></li>
</ul>
</li>
<li><p><a class="reference external" href="https://www.roboternetz.de/community/threads/29582-Brushless-Regler-ansteuern">https://www.roboternetz.de/community/threads/29582-Brushless-Regler-ansteuern</a></p>
<p>Pinout</p>
<ul class="simple">
<li><p>red +5V</p></li>
<li><p>black GND</p></li>
<li><p>yellow PWM</p></li>
</ul>
<p>Control</p>
<ul class="simple">
<li><p>duty &lt; 1ms backward</p></li>
<li><p>duty &gt; 1ms forward</p></li>
</ul>
</li>
<li><p>Crappy Python program
<a class="reference external" href="https://www.instructables.com/id/Driving-an-ESCBrushless-Motor-Using-Raspberry-Pi/">https://www.instructables.com/id/Driving-an-ESCBrushless-Motor-Using-Raspberry-Pi/</a></p></li>
</ul>
</div>
<div class="section" id="links">
<h3><a class="toc-backref" href="#id7">Links</a><a class="headerlink" href="#links" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://rn-wissen.de/wiki/index.php/Servos">https://rn-wissen.de/wiki/index.php/Servos</a></p></li>
<li><p><a class="reference external" href="https://www.mikrocontroller.net/articles/Brushless-Controller_f%C3%BCr_Modellbaumotoren">https://www.mikrocontroller.net/articles/Brushless-Controller_f%C3%BCr_Modellbaumotoren</a></p></li>
</ul>
<p>Calibration</p>
<p><a class="reference external" href="https://ardupilot.org/plane/docs/guide-esc-calibration.html">https://ardupilot.org/plane/docs/guide-esc-calibration.html</a></p>
</div>
</div>
</div>

  <div class="section">
  
  
  </div>

          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2020, Jörg Faschingbauer.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../../../../_sources/about/site/opentraining/misc/draft-topics/brushless-motor.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>